PROC SQL ;

OPTIONS MISSING='';

CREATE TABLE SDW_S060201_PARTA_VW AS 

SELECT 

	C0040 INFORMAT=$24. FORMAT=$24. LENGTH=24 LABEL = 's2c_dim:UI'
	, C0070 INFORMAT=$23. FORMAT=$23. LENGTH=23 LABEL = 'C0070'
	, C0080 INFORMAT=$23. FORMAT=$23. LENGTH=23 LABEL = 'C0080'
	
	, C0060 INFORMAT=$14. FORMAT=$14. LENGTH=14 LABEL = 'C0060'
	, PORT.XBRL_CD AS C0060_XBRL  INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0060_XBRL'

	, C0090 LENGTH=4   INFORMAT=$14. FORMAT=$14. LENGTH=14 LABEL = 'C0090'	
	, LINK.XBRL_CD AS C0090_XBRL  INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0090_XBRL'

	, C0100 INFORMAT=$14. FORMAT=$14. LENGTH=14 LABEL = 'C0100'	
	, COLL.XBRL_CD AS C0100_XBRL INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0100_XBRL'

	, C0110 INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0110'
	, CASE 
		WHEN C0110 = 'GBXT' THEN 's2c_GA:x115' 
		ELSE CASE 
				WHEN C0110 = '' THEN ''
				ELSE TRIM('s2c_GA:'||TRIM(C0110)) 
			 END 
	  END AS C0110_XBRL INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0110_XBRL'

	, C0120  INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0120'
	, C0130 FORMAT = 12.4 LABEL='C0130'
	, C0140 FORMAT = 12.2 LABEL='C0140'

	, C0150 INFORMAT=$14. FORMAT=$14. LENGTH=14 LABEL = 'C0150'
	, SUBSTR(TRIM(VALU.XBRL_CD),1,INDEX(TRIM(VALU.XBRL_CD),'/')-1) AS C0150_XBRL INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0150_XBRL'

	, C0160 FORMAT = 12.2 LABEL='C0160'
	, C0170 FORMAT = 12.2 LABEL='C0170'
	, C0180 FORMAT = 12.2 LABEL='C0180'

FROM 
	SDW_S060201_PART_A 

LEFT JOIN 
	X_EIOPA_CD PORT
		ON 
			C0060 = PORT.EIOPA_CD
			AND PORT.EFFECTIVE_TO_DATE = '31/12/9999  23:59:59'
			AND PORT.EIOPA_CATEGORY = 'PORTFOLIO_CLASSIFICATION'

LEFT JOIN 
	X_EIOPA_CD LINK
		ON 
			TRIM(C0090) = TRIM(LINK.EIOPA_CD)
			AND LINK.EFFECTIVE_TO_DATE = '31/12/9999  23:59:59'
			AND TRIM(LINK.EIOPA_CATEGORY) = 'UNIT_INDEX_LINKED'

LEFT JOIN 
	X_EIOPA_CD COLL
		ON 
			C0100 = COLL.EIOPA_CD
			AND COLL.EFFECTIVE_TO_DATE = '31/12/9999  23:59:59'
			AND TRIM(COLL.EIOPA_CATEGORY) = 'COLLATERAL_STATUS'

LEFT JOIN 
	X_EIOPA_CD VALU
		ON 
			C0150 = VALU.EIOPA_CD 
			AND VALU.EFFECTIVE_TO_DATE = '31/12/9999  23:59:59'
			AND TRIM(VALU.EIOPA_CATEGORY) = 'VALUATION_METHOD'
WHERE 
	C0040 <> '';


CREATE TABLE SDW_S060201_PARTB_VW AS 

SELECT 
	
 	C0040 INFORMAT=$24. FORMAT=$24. LENGTH=24 LABEL = 's2c_dim:UI'
	, C0190 INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0190'
	, C0200 INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0200'
	, C0210 INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0210'

	, CASE 
		WHEN C0230 = '' THEN '' 
		ELSE 's2c_NC:'||TRIM(C0230) 
	  END AS C0230_XBRL INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0230_XBRL'
	, C0230 INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0230'

	, C0240  INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0240'
	, C0250  INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0250'

	, CASE 
		WHEN C0270 = '' THEN ''
		WHEN C0270 = 'GBXT' THEN 's2c_GA:x115'
		WHEN C0270 = 'GIXT' THEN 's2c_GA:x116'
		ELSE 's2c_GA:'||C0270
	  END AS C0270_XBRL INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0270_XBRL'
	, C0270 INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0270'

	, CASE 
		WHEN C0280 = '' THEN ''
		ELSE 's2c_CU:'||C0280
	  END AS C0280_XBRL INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0280_XBRL'
	, C0280 INFORMAT=$10. FORMAT=$10. LENGTH=10 LABEL = 'C0280'

	, C0290 INFORMAT=$4. FORMAT=$4. LENGTH=4 LABEL = 'C0290'

	, LKTHRU.XBRL_CD AS C0292_XBRL INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0292_XBRL' 
	, C0292  INFORMAT=$14. FORMAT=$14. LENGTH=14 LABEL = 'C0292'

	, INFRA.XBRL_CD AS C0300_XBRL INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0300_XBRL'
	, C0300  INFORMAT=$14. FORMAT=$14. LENGTH=14 LABEL = 'C0300'

	, PART.XBRL_CD AS C0310_XBRL  INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0310_XBRL'
	, C0310 INFORMAT=$14. FORMAT=$14. LENGTH=14 LABEL = 'C0310'

	, C0320 INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0320'

	, CASE 
		WHEN C0330 = 'S&P Global Ratings Europe Limited (LEI code:5493008B2TU3S6QE1E12)'  THEN 's2c_SE:x179'
		WHEN C0330 = 'Fitch Ratings Limited (LEI code: 2138009F8YAHVC8W3Q52)' THEN 's2c_SE:x147'
		WHEN C0330 = 'Moody¡¦s Investors Service Ltd (LEI code: 549300SM89WABHDNJ349)'  THEN 's2c_SE:x154'
		ELSE ECAI.XBRL_CD 
	   END AS C0330_XBRL INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0330_XBRL'
	, C0330 AS C0330 INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0330'

	, QUAL.XBRL_CD AS C0340_XBRL INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0340_XBRL'
	, C0340 INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0340'

	, C0350 INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0350'

	, C0360 FORMAT=COMMA15.4 INFORMAT=COMMA12. LABEL='C0360'

	/*Invoke is accepting only two decimals for these variables */
	, ROUND(C0370,0.01) AS C0370 FORMAT=COMMA12.4 INFORMAT=COMMA12. LABEL='C0370'
	, ROUND(C0380,0.0001) AS C0380 FORMAT = 12.4 INFORMAT=COMMA12. 

	, C0390 AS C0390 INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0390'

FROM 
	SDW_S060201_PART_B

LEFT JOIN 
	X_EIOPA_CD INFRA
		ON 
			C0300 = INFRA.EIOPA_CD
			AND INFRA.EFFECTIVE_TO_DATE = '31/12/9999  23:59:59'
			AND INFRA.EIOPA_CATEGORY = 'INFRASTRUCTURE_INVESTMENT'

LEFT JOIN 
	X_EIOPA_CD PART
		ON 
			CASE WHEN TRIM(C0310) = '2' THEN '10' ELSE TRIM(C0310) END  = TRIM(PART.EIOPA_CD)
			AND PART.EFFECTIVE_TO_DATE = '31/12/9999  23:59:59'
			AND TRIM(PART.EIOPA_CATEGORY) = 'PARTICIPATION_CD'

LEFT JOIN 
	X_EIOPA_CD ECAI
		ON 
			C0330 = ECAI.EIOPA_DESCRIPTION
			AND ECAI.EFFECTIVE_TO_DATE = '31/12/9999  23:59:59'
			AND TRIM(ECAI.EIOPA_CATEGORY) = 'ECAI'

LEFT JOIN 
	X_EIOPA_CD QUAL
		ON 
			C0340 = QUAL.EIOPA_CD 
			AND QUAL.EFFECTIVE_TO_DATE = '31/12/9999  23:59:59'
			AND TRIM(QUAL.EIOPA_CATEGORY) = 'CREDIT_QUALITY_STEP'

LEFT JOIN 
	X_EIOPA_CD LKTHRU
		ON 
			C0292 = LKTHRU.EIOPA_CD 
			AND LKTHRU.EFFECTIVE_TO_DATE = '31/12/9999  23:59:59'
			AND TRIM(LKTHRU.EIOPA_CATEGORY) = 'CIU_SCR'


			WHERE C0040 <> ''
		;
QUIT;



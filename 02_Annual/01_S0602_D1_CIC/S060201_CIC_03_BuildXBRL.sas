/*PartA eligible ID's*/
PROC SQL;
create table WORK.PART_A as 
	select scenario_ORDINAL from 
	(SELECT *
	 FROM
	XBRL.typedMember)
	group by scenario_ORDINAL
	/* 	A Part Records having 2 records */
	having count(*)>1;
QUIT;


PROC SQL;
	CREATE TABLE WORK.ARS_S060201_PARTA_VW AS 
	
		SELECT 
			TM.scenario_ORDINAL
			, SC.context_ORDINAL
			, CON.context_id
			
			, ID.ID AS C0040  INFORMAT=$24. FORMAT=$24. LENGTH=24 LABEL = 's2c_dim:UI'
			
			, ID_C0070.ID AS C0070 INFORMAT=$23. FORMAT=$23. LENGTH=23 LABEL = 'C0070'
			
			, ID_C0080.ID AS C0080 INFORMAT=$23. FORMAT=$23. LENGTH=23 LABEL = 'C0080'
			
			, PORT.EIOPA_CD AS C0060 INFORMAT=$14. FORMAT=$14. LENGTH=14 LABEL = 'C0060'
			, C0060_TBL.ei2426 AS C0060_XBRL INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0060_XBRL'
				
			, LINK.EIOPA_CD AS C0090 INFORMAT=$14. FORMAT=$14. LENGTH=14 LABEL = 'C0090'	
			, C0090_TBL.ei1070 AS C0090_XBRL INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0090_XBRL'
			
		    , COLL.EIOPA_CD AS C0100  INFORMAT=$14. FORMAT=$14. LENGTH=14 LABEL = 'C0100'	
			, C0100_TBL.ei1007 AS C0100_XBRL INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0100_XBRL'
									
			, CASE 
					WHEN SUBSTR(TRIM(C0110_TBL.ei1061),INDEX(TRIM(C0110_TBL.ei1061),':')+1,LENGTH(TRIM(C0110_TBL.ei1061))) = 'x115' THEN 'GBXT' 
					ELSE SUBSTR(TRIM(C0110_TBL.ei1061),INDEX(TRIM(C0110_TBL.ei1061),':')+1,LENGTH(TRIM(C0110_TBL.ei1061)))
	  		   END AS C0110 INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0110'
	  		, C0110_TBL.ei1061 AS C0110_XBRL  INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0110_XBRL'
	  		   
	  		 , C0120_TBL.si1780 AS C0120 INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0120'
	  		 , C0130_TBL.ri2265 AS C0130 FORMAT = 12.4 LABEL='C0130'
	  		 , C0140_TBL.mi1110 AS C0140 FORMAT = 12.2 LABEL='C0140'
	  		 
	  		 , VALU.EIOPA_CD AS C0150 INFORMAT=$14. FORMAT=$14. LENGTH=14 LABEL = 'C0150'
	  		 , C0150_TBL.ei2218 AS C0150_XBRL INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0150_XBRL'
	  		 	  		 
	  		 , C0160_TBL.mi1987 AS C0160 FORMAT = 12.2 LABEL='C0160'
	  		 , C0170_TBL.mi1131 AS C0170 FORMAT = 12.2 LABEL='C0170'
	  		 , C0180_TBL.mi1128 AS C0180 FORMAT = 12.2 LABEL='C0180'

		FROM 
			XBRL.typedMember TM 

		INNER JOIN WORK.PART_A PA
			ON PA.scenario_ORDINAL=TM.scenario_ORDINAL
			
 		INNER JOIN XBRL.scenario SC  
 			ON SC.scenario_ORDINAL=TM.scenario_ORDINAL  
						
		INNER JOIN XBRL.context CON 
			ON CON.context_ORDINAL=SC.context_ORDINAL 			

		LEFT JOIN XBRL.ID ID
			ON TM.typedMember_ORDINAL = ID.typedMember_ORDINAL
			AND TM.typedMember_dimension='s2c_dim:UI' 
		
		LEFT JOIN XBRL.typedMember TM1
			ON TM.typedMember_ORDINAL = TM1.typedMember_ORDINAL
			AND TM1.typedMember_dimension = 's2c_dim:NF'

		LEFT JOIN XBRL.ID ID_C0070
			ON TM1.typedMember_ORDINAL = ID_C0070.typedMember_ORDINAL			
			
		LEFT JOIN XBRL.typedMember TM2
			ON TM.typedMember_ORDINAL = TM2.typedMember_ORDINAL
			AND TM2.typedMember_dimension = 's2c_dim:MP'

		LEFT JOIN XBRL.ID ID_C0080
			ON TM2.typedMember_ORDINAL = ID_C0080.typedMember_ORDINAL			
						
		LEFT JOIN XBRL.ei2426 C0060_TBL 
			ON C0060_TBL.ei2426_contextRef=CON.context_id 
		
		LEFT JOIN XBRL.ei1070 C0090_TBL 
			ON C0090_TBL.ei1070_contextRef=CON.context_id 
		
		LEFT JOIN XBRL.ei1007 C0100_TBL
			ON C0100_TBL.ei1007_contextRef=CON.context_id 

		LEFT JOIN XBRL.ei1061 C0110_TBL
			ON C0110_TBL.ei1061_contextRef=CON.context_id 	

		LEFT JOIN XBRL.si1780 C0120_TBL 
			ON C0120_TBL.si1780_contextRef=CON.context_id 			
			
		LEFT JOIN XBRL.ri2265 C0130_TBL 
			ON C0130_TBL.ri2265_contextRef=CON.context_id 				
			
		LEFT JOIN XBRL.mi1110 C0140_TBL 
			ON C0140_TBL.mi1110_contextRef=CON.context_id 

		LEFT JOIN XBRL.ei2218 C0150_TBL 
			ON C0150_TBL.ei2218_contextRef=CON.context_id 
			
		LEFT JOIN XBRL.mi1987 C0160_TBL 
			ON C0160_TBL.mi1987_contextRef=CON.context_id 				
			
		LEFT JOIN XBRL.mi1131 C0170_TBL 
			ON C0170_TBL.mi1131_contextRef=CON.context_id 	
			
		LEFT JOIN XBRL.mi1128 C0180_TBL 
			ON C0180_TBL.mi1128_contextRef=CON.context_id 				
/* 		------------------------------------------- */
		
		LEFT JOIN X_EIOPA_CD PORT
		ON C0060_TBL.ei2426 = PORT.XBRL_CD
		AND PORT.EFFECTIVE_TO_DATE = '31/12/9999  23:59:59'

		LEFT JOIN X_EIOPA_CD LINK
		ON C0090_TBL.ei1070 = LINK.XBRL_CD
		AND LINK.EFFECTIVE_TO_DATE = '31/12/9999  23:59:59'

		LEFT JOIN X_EIOPA_CD COLL
		ON C0100_TBL.ei1007 = COLL.XBRL_CD
		AND COLL.EFFECTIVE_TO_DATE = '31/12/9999  23:59:59'		
		
		LEFT JOIN X_EIOPA_CD VALU
		ON C0150_TBL.ei2218 = SUBSTR(TRIM(VALU.XBRL_CD),1,INDEX(TRIM(VALU.XBRL_CD),'/')-1)
		AND VALU.EFFECTIVE_TO_DATE = '31/12/9999  23:59:59'
		
		WHERE
			ID.ID IS NOT MISSING
		
		ORDER BY 
			ID.ID;

/*----------DELETE TABLE PART_A--------------*/			
		DROP TABLE PART_A;

/*----------DROP COLUMNS FROM VW PART_A--------------*/		
		ALTER TABLE ARS_S060201_PARTA_VW
			DROP scenario_ORDINAL , context_ORDINAL, context_id ;
QUIT;



/*PartB eligible ID's*/
PROC SQL;
create table WORK.PART_B as 
	select scenario_ORDINAL from 
	(SELECT 
	* FROM
	XBRL.typedMember)
	group by scenario_ORDINAL
	/* 	A Part Records having 2 records */
	having count(*)=1;
QUIT;

PROC SQL;
	CREATE TABLE WORK.ARS_S060201_PARTB_VW AS 
	
		SELECT 
			TM.scenario_ORDINAL
			, SC.context_ORDINAL
			, CON.context_id
			
			, ID.ID AS C0040 INFORMAT=$24. FORMAT=$24. LENGTH=24 LABEL = 's2c_dim:UI'
			
			, C0190_TBL.si1338 AS C0190 INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0190'
			
			, C0200_TBL.si1381 AS C0200 INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0200' 			
			, C0210_TBL.si1552 AS C0210 INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0210'
			
			, C0230_TBL.ei1658 AS C0230_XBRL INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0230_XBRL'
			,CASE 
				WHEN C0230_TBL.ei1658 = '' THEN '' 
				WHEN C0230_TBL.ei1658 = 's2c_NC:x0' THEN C0230_TBL.ei1658
				ELSE SUBSTR(C0230_TBL.ei1658,LENGTH(C0230_TBL.ei1658)-4) 	
	  		 END AS C0230 INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0230'
	  		 
	  		, C0240_TBL.si1337 AS C0240 INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0240' 			 
			, C0250_TBL.si1553 AS C0250 INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0250'
			
			, C0270_TBL.ei1062 AS C0270_XBRL INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0270_XBRL'
			, CASE 
				WHEN SUBSTR(TRIM(C0270_TBL.ei1062),INDEX(TRIM(C0270_TBL.ei1062),':')+1,LENGTH(TRIM(C0270_TBL.ei1062))) = 'x115' THEN 'GBXT' 
				WHEN SUBSTR(TRIM(C0270_TBL.ei1062),INDEX(TRIM(C0270_TBL.ei1062),':')+1,LENGTH(TRIM(C0270_TBL.ei1062))) = 'x116' THEN 'GIXT' 
				ELSE SUBSTR(TRIM(C0270_TBL.ei1062),INDEX(TRIM(C0270_TBL.ei1062),':')+1,LENGTH(TRIM(C0270_TBL.ei1062)))
	  		  END AS C0270 INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0270'
	  		  
	  		, C0280_TBL.ei1024 AS C0280_XBRL INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0280_XBRL'
	  		, CASE 
				WHEN TRIM(C0280_TBL.ei1024) = '' THEN '' 
				ELSE SUBSTR(C0280_TBL.ei1024,LENGTH(C0280_TBL.ei1024)-2) 	
	  		  END AS C0280 INFORMAT=$10. FORMAT=$10. LENGTH=10 LABEL = 'C0280'
			
			, C0290_TBL.si1554 AS C0290 INFORMAT=$4. FORMAT=$4. LENGTH=4 LABEL = 'C0290'
			
			, C0292_TBL.ei2519 AS C0292_XBRL INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0292_XBRL'
			, LKTHRU.EIOPA_CD AS C0292 INFORMAT=$14. FORMAT=$14. LENGTH=14 LABEL = 'C0292'
 
 			, C0300_TBL.ei2422 AS C0300_XBRL INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0300_XBRL'
			, INFRA.EIOPA_CD AS C0300 INFORMAT=$14. FORMAT=$14. LENGTH=14 LABEL = 'C0300'
			
			, C0310_TBL.ei2520 AS C0310_XBRL  INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0310_XBRL'
			, CASE WHEN PART.EIOPA_CD = '10' THEN '2' ELSE PART.EIOPA_CD END AS C0310
				INFORMAT=$14. FORMAT=$14. LENGTH=14 LABEL = 'C0310'
			
			
			, '' AS C0320  INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0320'
		
			, '' AS C0330_XBRL INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0330_XBRL'
			, '' AS C0330  INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0330'
		
			, '' AS C0340_XBRL INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0340_XBRL'
			, '' AS C0340 INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0340'
		
			, '' AS C0350 INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0350'
			
			, C0360_TBL.ri2266 AS  C0360 FORMAT=COMMA15.4 INFORMAT=COMMA12. LABEL='C0360'
			
			, C0370_TBL.mi1126 AS C0370 FORMAT=COMMA12.4 INFORMAT=COMMA12. LABEL='C0370'
						
			, ROUND(C0380_TBL.pi1286,0.0001) AS C0380  FORMAT = 12.4 INFORMAT=COMMA12. 
			
			, '' AS C0390 INFORMAT=$88. FORMAT=$88. LENGTH=88 LABEL = 'C0390'
		
		FROM 
			XBRL.typedMember TM 

		INNER JOIN XBRL.ID ID
			ON TM.typedMember_ORDINAL = ID.typedMember_ORDINAL
		
		INNER JOIN PART_B PB
			ON PB.scenario_ORDINAL=TM.scenario_ORDINAL
			
 		INNER JOIN XBRL.scenario SC  
 			ON SC.scenario_ORDINAL=TM.scenario_ORDINAL  
						
		INNER JOIN XBRL.context CON 
			ON CON.context_ORDINAL=SC.context_ORDINAL 
				
		LEFT JOIN XBRL.si1338 C0190_TBL 
			ON C0190_TBL.si1338_contextRef=CON.context_id 
		
		LEFT JOIN XBRL.si1381 C0200_TBL 
			ON C0200_TBL.si1381_contextRef=CON.context_id 
		
		LEFT JOIN XBRL.si1552 C0210_TBL 
			ON C0210_TBL.si1552_contextRef=CON.context_id 
		
		LEFT JOIN XBRL.ei1658 C0230_TBL
			ON C0230_TBL.ei1658_contextRef=CON.context_id 
			
		LEFT JOIN XBRL.si1337 C0240_TBL 
			ON C0240_TBL.si1337_contextRef=CON.context_id 
		
		LEFT JOIN XBRL.si1553 C0250_TBL 
			ON C0250_TBL.si1553_contextRef=CON.context_id 			

		LEFT JOIN XBRL.ei1062 C0270_TBL
			ON C0270_TBL.ei1062_contextRef=CON.context_id 

		LEFT JOIN XBRL.ei1024 C0280_TBL
			ON C0280_TBL.ei1024_contextRef=CON.context_id 			

		LEFT JOIN XBRL.si1554 C0290_TBL
			ON C0290_TBL.si1554_contextRef=CON.context_id 	

		LEFT JOIN XBRL.ei2519 C0292_TBL 
			ON C0292_TBL.ei2519_contextRef=CON.context_id 			

		LEFT JOIN XBRL.ei2422 C0300_TBL 
			ON C0300_TBL.ei2422_contextRef=CON.context_id 			
			
		LEFT JOIN XBRL.ei2520 C0310_TBL 
			ON C0310_TBL.ei2520_contextRef=CON.context_id 				
		
		LEFT JOIN XBRL.ri2266 C0360_TBL 
			ON C0360_TBL.ri2266_contextRef=CON.context_id 	

		LEFT JOIN XBRL.mi1126 C0370_TBL 
			ON C0370_TBL.mi1126_contextRef=CON.context_id 	
			
		LEFT JOIN XBRL.pi1286 C0380_TBL 
			ON C0380_TBL.pi1286_contextRef=CON.context_id 				
	
/* 		------------------------------------------- */
		
		LEFT JOIN X_EIOPA_CD LKTHRU
		ON  C0292_TBL.ei2519 =  LKTHRU.XBRL_CD
		AND LKTHRU.EFFECTIVE_TO_DATE = '31/12/9999  23:59:59'

		LEFT JOIN X_EIOPA_CD INFRA
		ON C0300_TBL.ei2422 = INFRA.XBRL_CD
		AND INFRA.EFFECTIVE_TO_DATE = '31/12/9999  23:59:59'
	
		LEFT JOIN X_EIOPA_CD PART
		ON C0310_TBL.ei2520 = PART.XBRL_CD
		AND PART.EFFECTIVE_TO_DATE = '31/12/9999  23:59:59'

		WHERE 
			TM.typedMember_dimension = 's2c_dim:UI' 
		
		ORDER BY 
			ID.ID;
			

/*----------DELETE TABLE PART_A--------------*/			
		DROP TABLE PART_B;

/*----------DROP COLUMNS FROM VW PART_A--------------*/		
		ALTER TABLE ARS_S060201_PARTB_VW
			DROP scenario_ORDINAL , context_ORDINAL, context_id ;			
QUIT;